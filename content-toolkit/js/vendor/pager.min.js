!function(e,t){var n=function(t,n){"use strict";var a=function(e,t){return function(){var a=arguments;return n.computed(function(){return e.apply(t,a)})}},i={};i.page=null,i.now=function(){return Date.now?Date.now():(new Date).valueOf()},i.extendWithPage=function(e){var t=new i.Page;e.$__page__=t,i.page=t,i.activePage$=a(i.getActivePage,i)()};var r=function(e,t,n){n=n||{},n.page=e,i[t].fire(n),e.val(t)&&e.val(t)(n)};t.each(["onBindingError","onSourceError","onNoMatch","onMatch","beforeRemove","afterRemove","beforeHide","afterHide","beforeShow","afterShow"],function(e,n){i[n]=t.Callbacks()}),i.showChild=function(e){var t=e&&1===e.length&&""===e[0]?[]:e;i.page.showPage(t)},i.getParentPage=function(e){for(;e;){if(e.$page&&"none"!==e.$page.val("urlToggle"))return e.$page;if(e.$data&&e.$data.$__page__)return e.$data.$__page__;e=e.$parentContext}return null};var o=null,l=null,s=function(e){l&&l.reject({cancel:!0}),o=null,e.substring(0,i.Href.hash.length)===i.Href.hash&&(e=e.slice(i.Href.hash.length));var t=u(e);i.showChild(t)};i.goTo=s,i.navigate=function(e){i.useHTML5history?i.Href5.history.pushState(null,null,e):location.hash=e};var u=function(e){return t.map(e.replace(/\+/g," ").split("/"),decodeURIComponent)},h={};h.value=n.utils.unwrapObservable,h.arrayValue=function(e){return t.map(e,function(e){return h.value(e)})};var c=function(e){for(var t,n={},a=/([^&=]+)=?([^&]*)/g;t=a.exec(e);)n[t[1]]=t[2];return n},d=function(e){if(!e)return{name:null,params:{}};var t=e.split("?"),n=t[0],a=t[1],i={};return a&&(i=c(a)),{name:n,params:i}};i.ChildManager=function(e,a){this.currentChildO=n.observable(null);var o=this;this.page=a,this.timeStamp=i.now(),this.hideChild=function(){var e=o.currentChildO();e&&(e.hidePage(function(){}),o.currentChildO(null))},this.showChild=function(n){var a=0===n.length;this.timeStamp=i.now();var l=this.timeStamp,s=o.currentChildO(),u=null,c=!1,f=d(n[0]),g=f.name,v=null;t.each(e(),function(e,t){if(!c){var n=t.getId();(n===g||(""===g||null==g)&&t.isStartPage())&&(c=!0,u=t),"?"===n&&(v=t)}});for(var p=!1,m=o,b=function(e,t){if(!c){var n=t.getId(),a=t.getValue().modal;a&&((n===g||(""===g||null==g)&&t.isStartPage())&&(c=!0,u=t,p=!0),"?"!==n||v||(v=t,p=!0))}};!u&&m.page.parentPage&&!m.page.getValue().modal;){var P=m.page.parentPage.children;t.each(P(),b),u||(m=m.page.parentPage.childManager)}u||!v||a||(u=v),o.currentChildO(u),u&&(p?u.currentParentPage(o.page):u.currentParentPage(null));var x=function(){r(o.page,"onNoMatch",{route:n})},w=function(){r(o.page,"onMatch",{route:n});var e=h.value(u.getValue().guard);e?e(u,n,function(){o.timeStamp===l&&u.showPage(n.slice(1),f,n[0])},s):u.showPage(n.slice(1),f,n[0])};s&&s===u?w():s?s.hidePage(function(){u?w():x()}):u?w():x()}},i.Page=function(e,t,a,r,o){this.element=e,this.valueAccessor=t,this.allBindingsAccessor=a,this.viewModel=r,this.bindingContext=o,this.children=n.observableArray([]),this.childManager=new i.ChildManager(this.children,this),this.parentPage=null,this.currentId=null,this.getCurrentId=n.observable(),this.ctx=null,this.currentParentPage=n.observable(null),this.isVisible=n.observable(!1),this.originalRoute=n.observable(null),this.route=null};var f=i.Page.prototype;f.val=function(e){return h.value(this.getValue()[e])},f.currentChildPage=function(){return this.childManager.currentChildO},f.find=function(e){var n=h.value(e),a=this;if("/"===n.substring(0,1))a=i.page,n=n.slice(1);else for(;"../"===n.substring(0,3);)a=a.currentParentPage&&a.currentParentPage()?a.currentParentPage():a.parentPage,n=n.slice(3);var r=u(n);return t.each(r,function(e,t){a=a.child(t)()}),a},f.find$=function(e){return a(this.find,this)(e)};var g=function(e){return i.useHTML5history?t("base").attr("href")+e:i.Href.hash+e};f.path=function(e){var n=this,a=h.value(e);if(a&&"object"==typeof a&&a.path&&a.params&&!(a instanceof i.Page)){var r=a.path,o=a.params;return n.path(r)+"?"+t.param(o)}var l;if(null==a||""===a)l=n;else{if(!(a instanceof i.Page)){if("/"===a.substring(0,1)){var s=i.page.getFullRoute()().join("/")+a.substring(1);return g(s)}for(var u=0;"../"===a.substring(0,3);)u++,a=a.slice(3);var c=n.getFullRoute()(),d=c.slice(0,c.length-u).join("/"),f=(""===d?"":d+"/")+a;return g(f)}l=a}return g(l.getFullRoute()().join("/"))},f.path$=function(e){return a(this.path,this)(e)},f.async=function(e,t,n,a){var r=this;return function(){l&&l.reject({cancel:!0});var s=e();l=s,a&&a(s.state());var u=Math.random();o=u,s.done(function(){a&&a(s.state()),u===o&&i.navigate(r.path(t))}),s.fail(function(e){a&&a(s.state());var t=e&&e.cancel;u===o&&!t&&n&&i.navigate(r.path(n))})}},f.showPage=function(e,t,n){var a=this,i=a.currentId,r=a.pageRoute?a.pageRoute.params:null,o=a.isVisible();a.currentId=t?t.name||"":"",a.getCurrentId(a.currentId),a.isVisible(!0),n&&a.originalRoute(n),a.route=e,a.pageRoute=t,o?("?"===a.getId()&&i!==a.currentId&&a.show(),t&&r!==t.params&&a.setParams()):(a.setParams(),a.show()),a.childManager.showChild(e)},f.setParams=function(){if(this.pageRoute&&this.pageRoute.params){var e=this.pageRoute.params,a=this.ctx,i=this.val("params")||{};t.isArray(i)?t.each(i,function(t,i){var r=e[i];a[i]?a[i](r):a[i]=n.observable(r)}):t.each(i,function(t,i){var r,o=e[t];r=null==o?h.value(i):o,a[t]?a[t](r):a[t]=n.observable(r)})}if(this.pageRoute){var r=this.getValue().nameParam;r&&("string"==typeof r?this.ctx[r]?this.ctx[r](this.currentId):this.ctx[r]=n.observable(this.currentId):r(this.currentId))}},f.hidePage=function(e){var t=this;"show"!==t.val("urlToggle")?(t.hideElementWrapper(e),t.childManager.hideChild()):e&&e()};var v=function(e){try{n.applyBindingsToDescendants(e.childBindingContext,e.element)}catch(t){r(e,"onBindingError",{error:t})}};f.init=function(){var e=this,a=e.val("urlToggle"),i=e.val("id");"?"!==i&&e.getCurrentId(i);var o=n.utils.domData.get(e.element,"__ko_pagerjsBindingData");if(o)return{controlsDescendantBindings:!0};n.utils.domData.set(e.element,"__ko_pagerjsBindingData",e),n.utils.domNodeDisposal.addDisposeCallback(e.element,function(){r(e,"beforeRemove"),e.parentPage&&e.parentPage.children.remove(e),r(e,"afterRemove")});var l=e.getValue();if("none"!==a&&(e.parentPage=e.getParentPage(),e.parentPage.children.push(this),e.hideElement()),e.val("source")&&e.loadSource(e.val("source")),e.ctx=null,l.withOnShow)e.ctx={},e.childBindingContext=e.bindingContext.createChildContext(e.ctx),n.utils.extend(e.childBindingContext,{$page:this});else{var s=l["with"]||e.bindingContext.$observableData||e.viewModel;if(e.ctx=h.value(s),e.augmentContext(),n.isObservable(s)){var u=n.observable(e.ctx);e.childBindingContext=e.bindingContext.createChildContext(u),n.utils.extend(e.childBindingContext,{$page:this,$observableData:s}),v(e),s.subscribe(function(){u(h.value(s))})}else e.childBindingContext=e.bindingContext.createChildContext(e.ctx),n.utils.extend(e.childBindingContext,{$page:this,$observableData:void 0}),v(e)}if("none"!==a){var c=e.parentPage;c.route&&(c.route[0]===e.getId()||c.route.length&&"?"===e.getId())&&setTimeout(function(){c.showPage(c.route)},0)}else{var d=function(){t(e.element).is(":visible")&&e.showPage([])};setTimeout(d,0),e.getParentPage().isVisible.subscribe(function(e){e&&setTimeout(d,0)})}var f=e.getValue().bind;return n.isObservable(f)&&f(e),{controlsDescendantBindings:!0}},f.augmentContext=function(){var e=this,a=e.val("params");a&&(t.isArray(a)?t.each(a,function(t,a){e.ctx[a]||(e.ctx[a]=n.observable())}):t.each(a,function(t,i){e.ctx[t]||(n.isObservable(i)?e.ctx[t]=i:null===i?(a[t]=n.observable(null),e.ctx[t]=n.observable(null)):e.ctx[t]=n.observable(i))})),this.val("vars")&&t.each(this.val("vars"),function(t,a){e.ctx[t]=n.isObservable(a)?a:n.observable(a)});var i=this.getValue().nameParam;i&&"string"==typeof i&&(e.ctx[i]=n.observable(null)),this.setParams()},f.getValue=function(){return this.valueAccessor?h.value(this.valueAccessor()):{}},f.getParentPage=function(){return i.getParentPage(this.bindingContext)},f.getId=function(){return this.val("id")},f.id=function(){var e=this.getCurrentId();return null==e||""===e?this.getId():e},f.sourceUrl=function(e){var t=this;return"?"===this.getId()?n.computed(function(){var n;return n=t.val("deep")?[t.currentId].concat(t.route).join("/"):t.currentId,h.value(e).replace("{1}",n)}):n.computed(function(){return h.value(e)})},f.loadWithOnShow=function(){var e=this;e.withOnShowLoaded&&e.val("sourceCache")===!0||(e.withOnShowLoaded=!0,e.val("withOnShow")(function(t){var a=e.bindingContext.createChildContext(t);e.ctx=t,e.childBindingContext=a,e.augmentContext(),n.utils.extend(a,{$page:e}),v(e),e.route&&e.childManager.showChild(e.route)},e))},f.loadSource=function(e){var a=this.getValue(),r=this,o=this.element,l=null,s=a.loader||i.loader;if("iframe"===a.frame){var u=t("iframe",t(o));0===u.length&&(u=t("<iframe></iframe>"),t(o).append(u)),s&&(l=h.value(s)(r,u),l.load()),u.one("load",function(){l&&l.unload(),a.sourceLoaded&&a.sourceLoaded(r)}),n.applyBindingsToNode(u[0],{attr:{src:this.sourceUrl(e)}})}else{s&&(l=h.value(s)(r,r.element),l.load());var c=function(){l&&l.unload(),r.val("withOnShow")?r.val("withOnShow")&&r.loadWithOnShow():v(r),a.sourceLoaded&&a.sourceLoaded(r),r.route&&r.childManager.showChild(r.route)};if("string"==typeof h.value(e)){var d=h.value(this.sourceUrl(e));m(o,d,function(){c()},r)}else{var f=t(o).children();h.value(e)(this,function(){t.each(f,function(e,t){n.utils.domNodeDisposal.removeNode(t)}),c()})}}};var p=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,m=function(e,a,i,o){var l,s,u=t(e),h=a.indexOf(" ");h>=0&&(l=a.slice(h,a.length),a=a.slice(0,h));var c=jQuery.ajax({url:a,type:"GET",dataType:"html",complete:function(e,t){i&&u.each(i,s||[e.responseText,t,e])}}).done(function(e){s=arguments,t.each(u.children(),function(e,t){n.utils.domNodeDisposal.removeNode(t)}),u.html(l?jQuery("<div>").append(e.replace(p,"")).find(l):e)});return c.fail(function(){r(o,"onSourceError",{url:a,xhrPromise:c})}),u};f.show=function(t){var n=this.element,a=this;a.showElementWrapper(t),a.val("title")&&(e.document.title=a.val("title")),a.val("sourceOnShow")?(!a.val("sourceCache")||!n.__pagerLoaded__||"number"==typeof a.val("sourceCache")&&n.__pagerLoaded__+1e3*a.val("sourceCache")<i.now())&&(n.__pagerLoaded__=i.now(),a.loadSource(a.val("sourceOnShow"))):a.val("withOnShow")&&a.loadWithOnShow()},f.titleOrId=function(){return this.val("title")||this.id()},f.showElementWrapper=function(e){var t=this;r(t,"beforeShow"),t.showElement(e),t.val("scrollToTop")&&t.element.scrollIntoView(),r(t,"afterShow")},f.showElement=function(e){this.val("showElement")?this.val("showElement")(this,e):this.val("fx")?i.fx[this.val("fx")].showElement(this,e):i.showElement?i.showElement(this,e):t(this.element).show(e)},f.hideElementWrapper=function(e){this.isVisible(!1),r(this,"beforeHide"),this.hideElement(e),r(this,"afterHide")},f.hideElement=function(e){this.val("hideElement")?this.val("hideElement")(this,e):this.val("fx")?i.fx[this.val("fx")].hideElement(this,e):i.hideElement?i.hideElement(this,e):(t(this.element).hide(),e&&e())},f.getFullRoute=function(){return this._fullRoute?this._fullRoute:(this._fullRoute=n.computed(function(){var e=null;return this.currentParentPage&&this.currentParentPage()?(e=this.currentParentPage().getFullRoute()().slice(0),e.push(this.originalRoute()||this.getId()),e):this.parentPage?(e=this.parentPage.getFullRoute()().slice(0),e.push(this.originalRoute()||this.getId()),e):[]},this),this._fullRoute)},f.getRole=function(){return this.val("role")||"next"},f.isStartPage=function(){return"start"===this.getId()||"start"===this.getRole()},f.nullObject=new i.Page,f.nullObject.children=n.observableArray([]),f.child=function(e){var a=this;return null==a._child&&(a._child={}),a._child[e]||(a._child[e]=n.computed(function(){var n=t.grep(this.children(),function(t){return t.id()===e})[0];return n||this.nullObject},this)),a._child[e]},i.getActivePage=function(){for(var e=i.page;null!=e.currentChildPage()();)e=e.currentChildPage()();return e},n.bindingHandlers.page={init:function(e,t,n,a,r){var o=null;return h.value(t())instanceof i.Page?(o=h.value(t()),o.element=e,null==o.allBindingsAccessor&&(o.allBindingsAccessor=n),null==o.viewModel&&(o.viewModel=a),null==o.bindingContext&&(o.bindingContext=r)):o=new i.Page(e,t,n,a,r),o.init()}},i.useHTML5history=!1,i.rootURI="/",i.Href=function(e,t,a,i,r){this.element=e,this.bindingContext=r,this.path=n.observable(),this.pageOrRelativePath=n.observable(t)};var b=i.Href.prototype;return b.getParentPage=function(){return i.getParentPage(this.bindingContext)},b.init=function(){var e=this,t=e.getParentPage();e.path=n.computed(function(){var n=h.value(e.pageOrRelativePath()());return t.path(n)})},i.Href.hash="#",b.bind=function(){n.applyBindingsToNode(this.element,{attr:{href:this.path}})},b.update=function(e){this.pageOrRelativePath(e)},i.Href5=function(){i.Href.apply(this,arguments)},i.Href5.prototype=new i.Href,i.Href5.history=e.History,i.Href5.prototype.bind=function(){var e=this;n.applyBindingsToNode(e.element,{attr:{href:e.path},click:function(){var n=e.path();(""===n||"/"===n)&&(n=t("base").attr("href")),i.Href5.history.pushState(null,null,n)}})},n.bindingHandlers["page-href"]={init:function(e,t,n,a,r){var o=i.useHTML5history?i.Href5:i.Href,l=new o(e,t,n,a,r);l.init(),l.bind(),e.__ko__page=l},update:function(e,t){e.__ko__page.update(t)}},i.fx={},i.fx.cssAsync=function(e){return{showElement:function(n,a){var i=t(n.element);i.addClass(e),i.show();var r=setInterval(function(){clearInterval(r),i.addClass(e+"-in")},10),o=setInterval(function(){clearInterval(o),a&&a()},300)},hideElement:function(n,a){var i=t(n.element);if(n.pageHiddenOnce){i.removeClass(e+"-in");var r=setInterval(function(){clearInterval(r),a&&a(),i.hide()},300)}else n.pageHiddenOnce=!0,i.hide()}}},i.fx.zoom=i.fx.cssAsync("pagerjs-fx-zoom"),i.fx.flip=i.fx.cssAsync("pagerjs-fx-flip"),i.fx.popout=i.fx.cssAsync("pagerjs-fx-popout-modal"),i.fx.jQuerySync=function(e,n){return{showElement:function(n,a){e.call(t(n.element),300,a)},hideElement:function(e,a){n.call(t(e.element),300,function(){t(e.element).hide()}),a&&a()}}},i.fx.slide=i.fx.jQuerySync(t.fn.slideDown,t.fn.slideUp),i.fx.fade=i.fx.jQuerySync(t.fn.fadeIn,t.fn.fadeOut),i.startHistoryJs=function(t){var n="string"==typeof t?t:null;n&&i.Href5.history.pushState(null,null,n),i.Href5.history.Adapter.bind(e,"statechange",function(){var e=i.Href5.history.getState().url.replace(i.Href5.history.getBaseUrl(),"");s(e)}),i.Href5.history.Adapter.bind(e,"anchorchange",function(){s(location.hash)}),t&&t.noGo||s(i.Href5.history.getState().url.replace(i.Href5.history.getBaseUrl(),""))},i.start=function(n){var a="string"==typeof n?n:null;a&&(e.location.hash=i.Href.hash+a);var r=function(){s(e.location.hash)};t(e).bind("hashchange",r),n&&n.noGo||r()},i},a=e.define;"function"==typeof a&&"object"==typeof a.amd&&a.amd?a("pager",["knockout","jquery"],function(e,t){return n(t,e)}):e.pager=n(t,ko)}(window,jQuery);
